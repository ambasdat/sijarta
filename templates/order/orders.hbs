<main class="card shadow-xl max-w-screen-xl mx-auto my-24 bg-neutral text-neutral-content">
  <div class="flex w-full flex-col">
      <div class="card-body">
          <h1 class="stat-value text-center">
              Pesanan Jasa
          </h1>
      </div>

      <div class="divider"></div>

      <div class="card-body form-control grid grid-cols-3 items-end gap-4 w-full">

          <!-- Dropdown for "Kategori" -->
          <label for="kategori" class="form-control">
              <div class="label">
                  <span class="label-text">Kategori</span>
              </div>

              <select id="kategori" name="kategori" class="select select-primary w-full max-w-xs" required>
                <option value="-" disabled selected>Pilih Kategori</option>
                <option value="0">Semua</option>
                <option value="1">Home Cleaning</option>
                <option value="2">Deep Cleaning</option>
                <option value="3">Service AC</option>
                <option value="4">Massage</option>
                <option value="5">Hair Care</option>
              </select>
          </label>

          <!-- Dropdown for "Sub Kategori" -->
          <label for="subkategori" class="form-control">
              <div class="label">
                  <span class="label-text">Sub Kategori</span>
              </div>

              <select id="subkategori" name="subkategori" class="select select-secondary w-full max-w-xs" required disabled>
                <option value="-" disabled selected>Pilih Sub Kategori</option>
                <option value="0">Semua</option>
              </select>
          </label>
      
          <!-- Search Button -->
          <button id="searchButton" class="btn btn-warning">Search</button>

      </div>

      <div class="divider divider-warning px-5">Result</div>

      <!-- Orders Section -->
      <div id="ordersContainer" class="grid gap-4 p-5">
          <!-- Dummy data rows will appear here -->
      </div>

  </div>
</main>

<script>
  // Dummy data
  const orders = {{{jobs}}};
  
  const kategoriToSubkategori = {
    1: ["Daily Cleaning", "Setrika", "Kombo Cleaning"],
    2: ["Cuci Sofa", "Cuci Karpet", "Cuci Tirai"],
    3: [],
    4: ["Massage Therapy"],
    5: [],
  };
  
  const kategoriSelect = document.getElementById("kategori");
  const subkategoriSelect = document.getElementById("subkategori");
  const ordersContainer = document.getElementById("ordersContainer");
  
  // Populate subkategori options based on kategori selection
  kategoriSelect.addEventListener("change", function () {
    const selectedKategori = kategoriSelect.value;
  
    // Clear previous options
    subkategoriSelect.innerHTML =`
      <option value="-" disabled selected>Pilih Sub Kategori</option>
      <option value="0">Semua</option>
    `  
    if (selectedKategori && selectedKategori !== "0") {
      const subkategoris = kategoriToSubkategori[selectedKategori] || [];
      subkategoris.forEach((subkategori) => {
        const option = document.createElement("option");
        option.value = subkategori.toLowerCase().replace(/\s+/g, "_");
        option.textContent = subkategori;
        subkategoriSelect.appendChild(option);
      });
      subkategoriSelect.disabled = false;
    } else {
      subkategoriSelect.disabled = true;
    }
  });
  
  // Render orders dynamically
  function renderOrders(data) {
    ordersContainer.innerHTML = ""; // Clear previous results
    data.forEach((order) => {
      ordersContainer.innerHTML +=`
      <div class="card shadow-xl bg-base-100 p-4 rounded shadow-md grid grid-cols-3 items-center gap-1">
          <div>
              <p class="font-semibold">${order.subkategori}</p>
              <p class="text-sm stat-title p-1">Tgl pemesanan: ${order.tanggalPemesanan}</p>
              <p class="text-sm stat-title p-1">Tgl pekerjaan: ${order.tanggalPekerjaan}</p>
          </div>
          <div>
              <p class="font-semibold">${order.namaPelanggan}</p>
          </div>
          <div class="grid grid-cols-2 items-center justify-between gap-4">
              <p class="font-bold">${order.totalBiaya}</p>
              <button class="btn btn-warning">Kerjakan Pesanan</button>
          </div>
      </div>
      `
    });
  }
  
  // Initial render
  renderOrders(orders);
  
  // Search functionality
  document.getElementById("searchButton").addEventListener("click", () => {
    const selectedKategori = kategoriSelect.value;
    const selectedSubkategori = subkategoriSelect.value;

    console.log(selectedKategori, selectedSubkategori)
    
    const filteredOrders = orders.filter((order) => {
      const matchesKategori = selectedKategori === "0" || selectedKategori === "-" || kategoriToSubkategori[selectedKategori]?.includes(order.subkategori);
      const matchesSubkategori = selectedSubkategori === "0" || selectedSubkategori === "-" || order.subkategori
        .toLowerCase()
        .replace(/\s+/g, "_") === selectedSubkategori;
  
      return matchesKategori && matchesSubkategori;
    });
  
    renderOrders(filteredOrders);
  });
</script>
